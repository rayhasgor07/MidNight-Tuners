<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MidNight Tuners - Car Value</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" />
  <link rel="stylesheet" href="../style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="title">
    <b><text>VALUE ESTIMATOR</text></b>
  </div>
  <header>
    <div id="navigation">
      <a href="./home.html"><i class="fa-solid fa-house"></i></a>
      <a href="./feed.html"><i class="fa-solid fa-plus"></i></a>
      <a href="./learn.html"><i class="fa-solid fa-graduation-cap"></i></a>
      <a href="./mod.html"><i class="fa-solid fa-wrench"></i></a>
      <a href="./value.html"><i class="fa-solid fa-sack-dollar"></i></a>
    </div>
  </header>

  <div class="wrap">
    <div id="sub">
      <h3 style="text-align:center;">Car Value Estimator</h3>

      <!-- Brand dropdown -->
      <label for="brand">Select Brand:</label>
      <select id="brand" style="width:100%;padding:10px;margin:5px 0;border-radius:10px;">
        <option value="">-- Choose a Brand --</option>
      </select>

      <!-- Car/Generation dropdown -->
      <label for="car">Select Car/Generation:</label>
      <select id="car" style="width:100%;padding:10px;margin:5px 0;border-radius:10px;">
        <option value="">-- Choose a Car --</option>
      </select>

      <!-- Year dropdown -->
      <label for="year">Select Year:</label>
      <select id="year" style="width:100%;padding:10px;margin:5px 0;border-radius:10px;">
        <option value="">-- Choose Year --</option>
      </select>

      <label for="miles">Enter Mileage (km):</label>
      <input type="number" id="miles" placeholder="e.g. 45000" style="width:100%;padding:10px;margin:5px 0;border-radius:10px;"/>

      <button id="calculate" class="btn" style="margin-top:10px;width:100%;">Calculate Value</button>

      <h3 id="result" style="text-align:center;margin-top:20px;color:rgb(57, 69, 161);"></h3>

      <!-- Graph -->
      <canvas id="valueChart" style="margin-top:20px;max-height:350px;"></canvas>
    </div>
  </div>

  <footer>© 2025 Rayyan Hasan Goraya. All rights reserved.</footer>

  <script>
    let carData = {};

    // Load JSON file
    fetch('../value.json')
      .then(response => response.json())
      .then(data => {
        carData = data;
        populateBrandDropdown();
      });

    const brandSelect = document.getElementById('brand');
    const carSelect = document.getElementById('car');
    const yearSelect = document.getElementById('year');
    const ctx = document.getElementById('valueChart').getContext('2d');
    let chart = null;

    // Populate brand dropdown
    function populateBrandDropdown() {
      for (const brand in carData) {
        const opt = document.createElement('option');
        opt.value = brand;
        opt.textContent = brand;
        brandSelect.appendChild(opt);
      }
    }

    // When brand changes, populate car/generation dropdown
    brandSelect.addEventListener('change', () => {
      carSelect.innerHTML = '<option value="">-- Choose a Car --</option>';
      yearSelect.innerHTML = '<option value="">-- Choose Year --</option>';
      const brand = brandSelect.value;
      if (brand && carData[brand]) {
        for (const car in carData[brand]) {
          const opt = document.createElement('option');
          opt.value = car;
          opt.textContent = carData[brand][car].displayName;
          carSelect.appendChild(opt);
        }
      }
    });

    // When car changes, populate year dropdown
    carSelect.addEventListener('change', () => {
      yearSelect.innerHTML = '<option value="">-- Choose Year --</option>';
      const brand = brandSelect.value;
      const car = carSelect.value;
      if (brand && car && carData[brand][car]) {
        carData[brand][car].productionYears.forEach(y => {
          const opt = document.createElement('option');
          opt.value = y;
          opt.textContent = y;
          yearSelect.appendChild(opt);
        });
      }
    });

    // Calculate value
    document.getElementById('calculate').addEventListener('click', () => {
      const brand = brandSelect.value;
      const car = carSelect.value;
      const year = parseInt(yearSelect.value);
      const miles = parseInt(document.getElementById('miles').value);
      const result = document.getElementById('result');

      if (!brand || !car || !year || !miles) {
        result.textContent = "⚠️ Please fill out all fields.";
        result.style.color = "darkred";
        return;
      }

      const baseValue = carData[brand][car].values[year];

      // Mileage deduction formula (2% per 10k km)
      let value = baseValue - (miles / 10000) * (baseValue * 0.02);
      value = Math.max(value, 2000);

      result.textContent = `Estimated Value: $${value.toLocaleString(undefined, { maximumFractionDigits: 0 })} USD`;
      result.style.color = "darkred";

      // Graph: show all production years for that car/gen
      const years = carData[brand][car].productionYears;
      const values = years.map(y => {
        let v = carData[brand][car].values[y];
        v -= (miles / 10000) * (v * 0.02);
        return Math.max(v, 2000);
      });

      if (chart) chart.destroy();
     chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: years,
    datasets: [{
      label: `${carData[brand][car].displayName} Value Over Time`,
      data: values,
      borderColor: '#00ffff',          // bright cyan line
      backgroundColor: 'rgba(0,255,255,0.2)', // neon glow fill
      tension: 0.3,
      fill: true,
      borderWidth: 3,
      pointRadius: 4,
      pointBackgroundColor: '#ffeb3b', // yellow points
      pointBorderColor: '#00ffff'
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        display: true,
        position: 'top',
        labels: {
          color: '#ffffff',            // legend text color
          font: { size: 14 }
        }
      },
      tooltip: {
        enabled: true,
        backgroundColor: '#203a43',
        titleColor: '#00ffff',
        bodyColor: '#ffffff'
      }
    },
    scales: {
      x: {
        title: { display: true, text: 'Year', color: '#ffffff' },
        ticks: { color: '#ffffff' },
        grid: { color: 'rgba(255,255,255,0.1)' }
      },
      y: {
        title: { display: true, text: 'Value ($ USD)', color: '#ffffff' },
        ticks: { color: '#ffffff' },
        grid: { color: 'rgba(255,255,255,0.1)' }
      }
    }
  }
});
    });
  </script>
</body>
</html>